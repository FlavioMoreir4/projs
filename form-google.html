<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<style>
  .is-hidden {
    display: none !important;
  }

  @keyframes rotate {
    100% {
      transform: rotate(360deg);
    }
  }

  @keyframes dash {
    0% {
      stroke-dasharray: 1, 200;
      stroke-dashoffset: 0;
    }

    50% {
      stroke-dasharray: 89, 200;
      stroke-dashoffset: -35;
    }

    100% {
      stroke-dasharray: 89, 200;
      stroke-dashoffset: -124;
    }
  }

  .loading {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .loading-spinner {
    width: 25%;
    height: 25%;
    margin: 0 auto;
  }

  .loading-spinner svg {
    position: relative;
    animation: rotate 2s linear infinite;
  }

  .loading-spinner circle {
    stroke: #70c542;
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
    stroke-linecap: round;
    animation: dash 1.5s ease-in-out infinite;
  }
</style>
<div class="form-container">
  <form name="submit-to-google-sheet">

    <div class="form-group">
      <label for="candidato">Nome do candidato(a)</label>
      <input name="candidato" class="form-control" id="candidato" type="text" placeholder="Candidato" required>
    </div>

    <label for="idade">Idade</label>
    <div class="form-group">
      <select name="idade" class="form-control" id="idade" required>
        <option value=""></option>
        <option value="13" data-calc-value="13">
          13 </option>
        <option value="14" data-calc-value="14">
          14 </option>
        <option value="15" data-calc-value="15">
          15 </option>
        <option value="16" data-calc-value="16">
          16 </option>
        <option value="17" data-calc-value="17">
          17 </option>
        <option value="18" data-calc-value="18">
          18 </option>
      </select>
    </div>

    <label for="interesse">Interesse</label>
    <div class="form-group">
      <select name="interesse" class="form-control" id="interesse" required>
        <option value=""></option>
        <option value="Exército" data-calc-value="Exército">
          Exército </option>
        <option value="Marinha" data-calc-value="Marinha">
          Marinha </option>
        <option value="Aeronáutica" data-calc-value="Aeronáutica">
          Aeronáutica </option>
        <option value="Policia Militar" data-calc-value="Policia Militar">
          Policia Militar </option>
        <option value="Bombeiro Militar" data-calc-value="Bombeiro Militar">
          Bombeiro Militar </option>
      </select>
    </div>

    <div class="form-group">
      <label for="whatsapp">WhatsApp</label>
      <input name="whatsapp" class="form-control" id="whatsapp" type="text" placeholder="WhatsApp" required>
    </div>

    <div class="form-group">
      <label for="responsavel">Nome do Responsavel</label>
      <input name="responsavel" class="form-control" id="responsavel" type="text" placeholder="Responsável" required>
    </div>

    <div class="form-group">
      <label for="whatsapp-resp">WhatsApp do Responsável</label>
      <input name="whatsapp-do-responsavel" class="form-control" id="whatsapp-resp" type="text"
        placeholder="WhatsApp do Responsável" required>
    </div>

    <div class="form-group">
      <label for="telefone">Telefone</label>
      <input name="telefone" class="form-control" id="telefone" type="text" placeholder="Telefone" required>
    </div>

    <label for="regiao" id="regL">Região</label>
    <div class="form-group" id="regG">
      <select name="regiao" class="form-control" id="regiao" required="required" required>
        <option value=""></option>
        <option value="Carapicuíba" data-calc-value="Carapicuíba">
          Carapicuíba </option>
        <option value="Cotia" data-calc-value="Cotia">
          Cotia </option>
        <option value="Diadema" data-calc-value="Diadema">
          Diadema </option>
        <option value="Interlagos" data-calc-value="Interlagos">
          Interlagos </option>
        <option value="Lapa" data-calc-value="Lapa">
          Lapa </option>
        <option value="Osasco" data-calc-value="Osasco">
          Osasco </option>
        <option value="Santos" data-calc-value="Santos">
          Santos </option>
        <option value="São Bernardo do Campo" data-calc-value="São Bernardo do Campo">
          São Bernardo do Campo </option>
        <option value="Santo Amaro" data-calc-value="Santo Amaro">
          Santo Amaro </option>
        <option value="Santo André" data-calc-value="Santo André">
          Santo André </option>
        <option value="Vila Mariana" data-calc-value="Vila Mariana">
          Vila Mariana </option>
      </select>
    </div>

    <div class="form-group">
      <input type="hidden" name="campanha" id="campanha" value="Orgânico">
      <button type="submit" style="width: 100%;">Enviar</button>
    </div>
  </form>

  <div class="loading js-loading is-hidden">
    <div class="loading-spinner">
      <svg viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" /></svg>
    </div>
  </div>

  <div class="js-success-message is-hidden">
    <div>
      <h2 class="text-success">90% DO CADASTRO CONCLUÍDO</h2>
      <div class="progress bg-success">
        <div class="progress-bar bg-success" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"
          style="width:90%;background: #3c763d;">90%</div>
      </div>
      <h3>Clique no botão "<span class="font-weight-bold text-success bg-white">ENVIAR EU QUERO</span>", para finalizar!
        Clicando no botão Enviar "<span class="font-weight-bold text-success bg-white">ENVIAR EU QUERO</span>" abrira o
        WhatsApp, envie a mensagem que ira aparecer.
        Nossa equipe esta de prontidão para finalizar seu cadastro.</h3>
      <br>
      <h3>O CADASTRO SÓ SERÁ CONCLUÍDO POR WHATSAPP, ENVIANDO A MENSAGEM "EU QUERO"</h3>
    </div>

  </div>
  <p class="js-error-message is-hidden">Error!</p>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FlavioMoreiraTec/projs@master/jquery.mask.min.js">
</script>
<script src="https://cdn.jsdelivr.net/gh/FlavioMoreiraTec/projs@master/getparams.js"></script>
<script>
  var campanha = getParams("campanha");
  if (campanha) {
    document.getElementById('campanha').value = decodeURIComponent(campanha);
  }
  var r = getParams("r");
  var reg = document.getElementById("regiao");
  var regIndex;
  if (r) {
    switch (r) {
      case "carapicuiba":
        regIndex = "1";
        break;
      case "cotia":
        regIndex = "2";
        break;
      case "diadema":
        regIndex = "3";
        break;
      case "interlagos":
        regIndex = "4";
        break;
      case "lapa":
        regIndex = "5";
        break;
      case "osasco":
        regIndex = "6";
        break;
      case "santos":
        regIndex = "7";
        break;
      case "sbc":
        regIndex = "8";
        break;
      case "stoamaro":
        regIndex = "9";
        break;
      case "stoandre":
        regIndex = "10";
        break;
      case "vlmariana":
        regIndex = "11";
        break;
    }
    reg.selectedIndex = regIndex;
    document.getElementById("regL").style.display = "none";
    document.getElementById("regG").style.display = "none";
  }


  (function ($) {
    $('#whatsapp').mask('10 00000-0000');
    $('#whatsapp-resp').mask('10 00000-0000');
    var SPMaskBehavior = function (val) {
        return val.replace(/\D/g, '').length === 11 ? '00 00000-0000' : '00 0000-00009';
      },
      spOptions = {
        onKeyPress: function (val, e, field, options) {
          field.mask(SPMaskBehavior.apply({}, arguments), options);
        }
      };
    $('#telefone').mask(SPMaskBehavior, spOptions);
  })(jQuery);

  const scriptURL = 'LINK DO EXCRIPT'
  const form = document.forms['submit-to-google-sheet']
  const loading = document.querySelector('.js-loading')
  const successMessage = document.querySelector('.js-success-message')
  const errorMessage = document.querySelector('.js-error-message')

  form.addEventListener('submit', e => {
    e.preventDefault()
    showLoadingIndicator()
    fetch(scriptURL, {
        method: 'POST',
        body: new FormData(form)
      })
      .then(response => showSuccessMessage(response))
      .catch(error => showErrorMessage(error))
  })

  function showLoadingIndicator() {
    form.classList.add('is-hidden')
    loading.classList.remove('is-hidden')
  }

  function showSuccessMessage(response) {
    console.log('Success!', response)
    setTimeout(() => {
      successMessage.classList.remove('is-hidden')
      loading.classList.add('is-hidden')
      fbq('track', 'Lead');
      fbq('track', 'CompleteRegistration');
      whatsapp();
    }, 500)
  }

  function showErrorMessage(error) {
    console.error('Error!', error.message)
    setTimeout(() => {
      errorMessage.classList.remove('is-hidden')
      loading.classList.add('is-hidden')
    }, 500)
  }

  function whatsapp() {
    var resp = document.getElementById("responsavel").value;
    var can = document.getElementById("candidato").value;

    var tel_wpp = "5511954775958"; //IPMIL IOPEM
    switch (reg.value) {
      case "Santos":
        tel_wpp = "5511962349355"; //Whats da Unidade
        break;
    }
    let phone = tel_wpp; //document.getElementById('phone')
    let message = "*EU QUERO*\nCandidato: " + can + "\nResponsável: " + resp + "\nRegião: " + reg.value;
    if (resp == "") {
      message = "*EU QUERO*\nCandidato: " + can + "\nRegião: " + reg.value;
    }
    let isMobile = (function (a) {
      if (
        /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i
        .test(a) ||
        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
        .test(a.substr(0, 4))) {
        return true
      } else {
        return false
      }
    })(navigator.userAgent || navigator.vendor || window.opera)

    const makeLink = function () {
      let mount = function () {
        if (isMobile) {
          console.log('By Android')
          let target = `https://api.whatsapp.com/send?` //`whatsapp://send?`
          if (!!phone && phone !== '') {
            target += `phone=${encodeURIComponent(phone)}&`
          }
          if (!!message && message !== '') {
            target += `text=${encodeURIComponent(message)}`
          }
          return target
        } else {
          let target = `https://wa.me/`
          if (!!phone && phone.value !== '') {
            target += `${encodeURIComponent(phone)}`
          }
          if (!!message && message.value !== '') {
            target += `?text=${encodeURIComponent(message)}`
          }
          console.log('By Web')
          return target
        }

      }
      let openLink = function () {
        let a = document.createElement('a')
        a.href = mount()
        a.click()
      }
      openLink()
    }
    setTimeout(makeLink, 4000);
  }
</script>
